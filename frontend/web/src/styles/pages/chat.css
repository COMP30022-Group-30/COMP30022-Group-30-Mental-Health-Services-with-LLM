/* Chat layout shell */
.chat-route-main{
  min-height: 100dvh;
  padding: clamp(12px, 2vw, 24px) clamp(12px, 4vw, 36px) calc(clamp(12px, 2vw, 24px) + env(safe-area-inset-bottom, 0));
  background: var(--bg);
  display: flex;
  flex-direction: column;
  gap: clamp(12px, 2vw, 24px);
}

.chat-page{
  flex: 1 1 auto;
  display: grid;
  grid-template-columns: minmax(0, 320px) minmax(0, 1fr);
  grid-template-rows: minmax(0, 1fr) auto;
  grid-template-areas:
    "sidebar main"
    "sidebar composer";
  gap: clamp(16px, 2vw, 28px);
  min-height: 0;
}

.chat-page.-collapsed{
  grid-template-columns: 1fr;
  grid-template-areas:
    "main"
    "composer";
}

.chat-sidebar{
  grid-area: sidebar;
  display:flex;
  flex-direction:column;
  min-height:0;
  border-radius: clamp(18px, 2vw, 24px);
  border:1px solid color-mix(in srgb, var(--grey-200) 75%, transparent);
  background: color-mix(in srgb, var(--surface) 94%, rgba(255, 255, 255, 0.9));
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.12);
}

.sidebar-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 18px;
  border-bottom:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
}

.sidebar-body{
  padding:16px 18px;
  overflow:auto;
  min-height:0;
}

.hambtn{
  display:none;
}

@media (min-width: 901px){
  .hambtn{
    position:sticky;
    top:12px;
    left:12px;
    width:40px;
    height:40px;
    border-radius:12px;
    border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
    background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:1.25rem;
    cursor:pointer;
    box-shadow:0 12px 20px rgba(15, 23, 42, 0.12);
  }
}

.chat-main{
  grid-area: main;
  display:grid;
  grid-template-rows:auto auto 1fr;
  min-height:0;
  border-radius: clamp(18px, 2vw, 24px);
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
  box-shadow: 0 22px 48px rgba(15, 23, 42, 0.14);
}


.chat-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  min-height:48px;
  padding:14px 20px;
  border-bottom:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 98%, rgba(255, 255, 255, 0.8));
}

.chat-head-left{
  display:flex;
  align-items:center;
  gap:12px;
  min-width:0;
}

.chat-back{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
  color: var(--text);
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  transition: background 0.18s var(--ease), transform 0.18s var(--ease), box-shadow 0.18s var(--ease);
}

.chat-back svg{
  width:18px;
  height:18px;
}

.chat-back:hover{
  transform:translateY(-1px);
  background: color-mix(in srgb, var(--surface) 92%, rgba(255, 255, 255, 0.9));
  box-shadow:0 8px 16px rgba(15, 23, 42, 0.12);
}

.chat-back:focus-visible{
  outline:2px solid var(--focus);
  outline-offset:2px;
}

.chat-head h2{
  margin:0;
  font-size:1.1rem;
}

.chat-head .muted{
  font-size:0.85rem;
  white-space:nowrap;
}

.chat-alert{
  margin:12px 20px 0;
  padding:10px 14px;
  border:1px solid var(--warning-300, #f2b27b);
  background: var(--warning-50, #fff7ed);
  color: var(--warning-900, #7c3e1d);
  border-radius:16px;
  display:flex;
  align-items:center;
  gap:8px;
}

.alert-dismiss{
  margin-left:auto;
  border:0;
  background:transparent;
  cursor:pointer;
  font-size:18px;
  line-height:1;
  color:inherit;
  padding:2px 6px;
  border-radius:6px;
}

.alert-dismiss:hover{
  background: rgba(0,0,0,0.06);
}

.chat-scroller{
  min-height:0;
  overflow:auto;
  padding:20px clamp(16px, 4vw, 28px);
  overscroll-behavior:contain;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.chat-body{
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
}

.transcript{
  list-style:none;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.transcript > li{
  align-self:flex-start;
}

.transcript > li.user{
  align-self:flex-end;
}

.msg-timestamp{
  align-self:center;
  margin:6px auto 8px;
  padding:4px 10px;
  border-radius:999px;
  font-size:0.75rem;
  color: color-mix(in srgb, var(--muted) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 94%, rgba(255, 255, 255, 0.9));
}

.msg{
  max-width: min(72ch, 88%);
  padding:12px 14px;
  border-radius:18px;
  animation:bubbleIn .18s ease-out;
  line-height:1.4;
  font-size:0.95rem;
  box-shadow:0 8px 22px rgba(15, 23, 42, 0.1);
}

.msg.assistant{
  background: color-mix(in srgb, var(--surface) 98%, rgba(255, 255, 255, 0.85));
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
}

.msg.user{
  max-width: min(64ch, 76%);
  background: color-mix(in srgb, var(--brand) 16%, var(--surface));
  color: var(--text);
  border:1px solid color-mix(in srgb, var(--brand) 45%, transparent);
}

.msg-meta{
  font-size:0.75rem;
  color: var(--grey-600);
  margin-bottom:4px;
  display:flex;
  align-items:center;
  gap:6px;
}

.icon-inline{
  margin-left:6px;
  padding:2px 6px;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  border-radius:12px;
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
  cursor:pointer;
  font-size:0.75rem;
}

.msg-text{
  white-space:pre-wrap;
  word-break:break-word;
}

@keyframes bubbleIn{
  from{transform:translateY(3px); opacity:0;}
  to{transform:translateY(0); opacity:1;}
}

.typing-row{
  display:flex;
  justify-content:flex-start;
}

.typing-bubble{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:.45rem .65rem;
  border-radius:999px;
  background:var(--offwhite-3);
  border:1px solid var(--grey-300);
}

.typing-dot{
  width:6px;
  height:6px;
  border-radius:50%;
  background:var(--brand);
  animation: typingDot 1.2s infinite;
}

@keyframes typingDot{
  0%,60%,100%{transform:translateY(0); opacity:.6;}
  30%{transform:translateY(-3px); opacity:1;}
}

@keyframes pulse{
  0%{transform:scale(.95); opacity:.7;}
  70%{transform:scale(1.05); opacity:.25;}
  100%{transform:scale(.95); opacity:.7;}
}

.jump-latest{
  margin:0 auto;
  padding:6px 12px;
  border:1px solid var(--grey-300);
  border-radius:999px;
  background:var(--surface);
  font-size:0.85rem;
  box-shadow:0 8px 16px rgba(15, 23, 42, 0.12);
}

.composer-dock{
  grid-area: composer;
  position: sticky;
  bottom: 0;
  display:grid;
  gap:10px;
  padding:14px 18px calc(14px + env(safe-area-inset-bottom, 0));
  border-radius: clamp(18px, 2vw, 24px);
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.92));
  box-shadow:0 18px 40px rgba(15, 23, 42, 0.14);
  backdrop-filter: blur(12px);
}

.anon-pill{
  display:flex;
  align-items:center;
  gap:10px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 98%, rgba(255, 255, 255, 0.92));
  font-size:0.85rem;
  color: color-mix(in srgb, var(--text) 78%, transparent);
}

.anon-pill span{
  flex:1;
  min-width:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.anon-pill-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height:30px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid color-mix(in srgb, var(--brand) 60%, transparent);
  background: color-mix(in srgb, var(--surface) 95%, rgba(255, 255, 255, 0.9));
  color: var(--brand);
  font-weight:600;
  text-decoration:none;
  flex-shrink:0;
}

.anon-pill-link:hover{
  text-decoration:none;
  background: color-mix(in srgb, var(--surface) 90%, rgba(255, 255, 255, 0.95));
}

.anon-pill-close{
  border:none;
  background:transparent;
  color:inherit;
  width:28px;
  height:28px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:1rem;
  cursor:pointer;
  flex-shrink:0;
}

.anon-pill-close:hover{
  background: rgba(0,0,0,0.08);
}

.chat-anon-container{
  width:100%;
}

.chat-anon-text{
  flex:1;
  min-width:0;
}

.chat-anon-link{
  font-weight:600;
}

.chat-anon-close{
  cursor:pointer;
}

.chat-composer{
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
  gap:10px;
  width:100%;
}

.chat-composer textarea{
  width:100%;
  min-height:48px;
  min-width:0;
  border-radius:16px;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
  padding:12px 14px;
  font-size:1rem;
  line-height:1.45;
  resize:none;
  overflow-y:auto;
  transition: border-color 0.18s var(--ease), box-shadow 0.18s var(--ease);
}

.chat-composer textarea:focus-visible{
  border-color: color-mix(in srgb, var(--brand) 55%, transparent);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--brand) 35%, transparent);
  outline:none;
}

.composer-icon-btn{
  width:44px;
  height:44px;
  border-radius:50%;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.9));
  display:inline-flex;
  align-items:center;
  justify-content:center;
  color: var(--text);
  position:relative;
  transition: transform 0.18s var(--ease), background 0.18s var(--ease), box-shadow 0.18s var(--ease);
}

.composer-icon-btn svg{
  width:20px;
  height:20px;
}

.composer-icon-btn .spinner{
  width:20px;
  height:20px;
  animation:spin 1s linear infinite;
}

.chat-composer textarea::-webkit-scrollbar{
  width:6px;
}

.chat-composer textarea::-webkit-scrollbar-thumb{
  background: color-mix(in srgb, var(--grey-300) 70%, transparent);
  border-radius:999px;
}

.chat-composer textarea:disabled{
  background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.85));
  color: color-mix(in srgb, var(--muted) 65%, transparent);
}

.composer-icon-btn:hover:not(:disabled){
  transform:translateY(-1px);
  background: color-mix(in srgb, var(--surface) 90%, rgba(255, 255, 255, 0.9));
  box-shadow:0 10px 18px rgba(15, 23, 42, 0.12);
}

.composer-icon-btn.listening{
  border-color: color-mix(in srgb, var(--brand) 55%, transparent);
}

.composer-icon-btn.listening::after{
  content:'';
  position:absolute;
  inset:-4px;
  border-radius:50%;
  border:2px solid color-mix(in srgb, var(--brand) 55%, transparent);
  opacity:.6;
  animation:pulse 1s infinite;
}

.composer-icon-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  box-shadow:none;
}

@keyframes spin{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}

.composer-icon-btn.send{
  background: var(--brand);
  color: var(--brand-contrast);
  border:none;
  box-shadow:0 12px 24px rgba(33, 111, 90, 0.3);
}

.virtual-keyboard{
  grid-column:1 / -1;
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}

.virtual-keyboard-hint{
  margin:0;
  font-size:0.82rem;
  color: var(--grey-600);
}

.virtual-keyboard-keys{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

.vk-key{
  min-width:36px;
  padding:6px 10px;
  border-radius:12px;
  border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  background: color-mix(in srgb, var(--surface) 94%, rgba(255, 255, 255, 0.9));
  font-size:1.05rem;
  cursor:pointer;
  transition: background var(--dur-fast) var(--ease), transform var(--dur-fast) var(--ease);
}

.vk-key:hover{
  background: color-mix(in srgb, var(--surface) 86%, rgba(255, 255, 255, 0.9));
  transform: translateY(-1px);
}

@media (max-width: 900px){
  .chat-route-main{
    padding:12px 12px calc(12px + env(safe-area-inset-bottom, 0));
    gap:12px;
    overflow-x:hidden;
  }
  .chat-page{
    grid-template-columns:1fr;
    grid-template-rows:auto 1fr auto;
    grid-template-areas:
      "main"
      "main"
      "composer";
    gap:12px;
    min-height: calc(100dvh - 24px - env(safe-area-inset-bottom, 0));
    height: calc(100dvh - 24px - env(safe-area-inset-bottom, 0));
    overflow-x:hidden;
  }
  .chat-sidebar{
    display:none;
  }
  .chat-main{
    border:none;
    box-shadow:none;
    background:transparent;
    border-radius:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
    min-height:0;
  }
  .chat-head{
    padding:10px 12px;
    border-radius:16px;
    background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.92));
    border:1px solid color-mix(in srgb, var(--grey-200) 65%, transparent);
    flex-wrap:wrap;
    gap:8px 12px;
    align-items:flex-start;
    position:sticky;
    top:0;
    z-index:10;
  }
  .chat-back{
    padding:6px 10px;
    font-size:0.85rem;
  }
  .chat-head h2{
    font-size:1rem;
  }
  .chat-head .muted{
    font-size:0.78rem;
    white-space:normal;
    margin-left:auto;
    max-width:100%;
    text-align:right;
  }
  .chat-alert{
    margin:10px 0 0;
  }
  .chat-scroller{
    padding:16px 12px;
    flex:1 1 auto;
    min-height:0;
    gap:10px;
  }
  .chat-scroller::after{
    content:'';
    display:block;
    height:12px;
  }
  .chat-body{
    gap:10px;
  }
  .transcript{
    gap:10px;
  }
  .msg{
    max-width:90%;
    font-size:0.9rem;
    padding:10px 12px;
    box-shadow:0 8px 18px rgba(15, 23, 42, 0.1);
  }
  .msg-timestamp{
    font-size:0.7rem;
    margin:4px auto 6px;
  }
  .msg.user{
    max-width:78%;
    background: color-mix(in srgb, #ffffff 96%, transparent);
    border:1px solid color-mix(in srgb, var(--grey-200) 65%, transparent);
    color: var(--text);
  }
  .msg.assistant{
    background: color-mix(in srgb, var(--surface) 95%, rgba(255, 255, 255, 0.92));
    border:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
  }
  .composer-dock{
    padding:12px 12px calc(12px + env(safe-area-inset-bottom, 0));
    border:1px solid color-mix(in srgb, var(--grey-200) 65%, transparent);
    box-shadow:0 16px 32px rgba(15, 23, 42, 0.14);
    width:100%;
    gap:8px;
  }
  .chat-composer{
    gap:6px;
    grid-template-columns:auto 1fr auto;
    align-items:center;
  }
  .chat-composer textarea{
    font-size:0.95rem;
    padding:10px 12px;
  }
  .composer-icon-btn{
    width:40px;
    height:40px;
  }
  .composer-icon-btn svg{
    width:18px;
    height:18px;
  }
  .composer-icon-btn .spinner{
    width:18px;
    height:18px;
  }
  .anon-pill{
    padding:6px 10px;
    font-size:0.8rem;
  }
  .anon-pill-link{
    min-height:28px;
    padding:0 10px;
    font-size:0.78rem;
  }
}

@media (max-width: 768px){
  .chat-route-main{
    padding:0;
    gap:0;
  }
  .chat-shell{
    display:flex;
    flex-direction:column;
    min-height:100dvh;
    height:100dvh;
    background:var(--bg);
    overflow:hidden;
  }
  @supports not (min-height: 100dvh){
    .chat-shell{
      min-height:100vh;
      height:auto;
    }
  }
  .chat-topbar{
    position:sticky;
    top:0;
    z-index:40;
    padding-top:calc(env(safe-area-inset-top, 0));
    background: color-mix(in srgb, var(--surface) 97%, rgba(255, 255, 255, 0.94));
    border-bottom:1px solid color-mix(in srgb, var(--grey-200) 70%, transparent);
    backdrop-filter: blur(14px);
  }
  .chat-topbar .chat-head{
    padding:12px 16px;
    border:none;
    box-shadow:none;
    background:transparent;
    border-radius:0;
  }
  .chat-topbar .chat-head .muted{
    width:100%;
    text-align:right;
  }
  .chat-shell .chat-alert{
    margin:8px 16px;
  }
  .chat-messages{
    flex:1 1 auto;
    min-height:0;
    overflow-y:auto;
    overflow-x:hidden;
    padding:12px 16px 18px;
    scroll-behavior:smooth;
    scroll-padding-bottom:140px;
    -webkit-overflow-scrolling:touch;
  }
  .chat-messages .chat-body{
    gap:12px;
  }
  .chat-messages .jump-latest{
    position:sticky;
    bottom:16px;
    margin:16px auto 0;
    width:max-content;
  }
  .chat-anon-notice{
    display:flex;
    align-items:center;
    gap:10px;
    padding:8px 16px;
    font-size:0.85rem;
    color: color-mix(in srgb, var(--muted) 70%, transparent);
    border:none;
    border-bottom:1px solid color-mix(in srgb, var(--grey-200) 45%, transparent);
    background:transparent;
  }
  .chat-anon-text{
    flex:1;
    min-width:0;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .chat-anon-link{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    min-height:30px;
    padding:0 12px;
    border-radius:999px;
    border:1px solid color-mix(in srgb, var(--brand) 60%, transparent);
    background: color-mix(in srgb, var(--surface) 95%, rgba(255, 255, 255, 0.9));
    color: var(--brand);
    text-decoration:none;
  }
  .chat-anon-link:hover{
    background: color-mix(in srgb, var(--surface) 88%, rgba(255, 255, 255, 0.9));
    text-decoration:none;
  }
  .chat-anon-close{
    border:none;
    background:transparent;
    width:32px;
    height:32px;
    border-radius:50%;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-size:1rem;
    color:inherit;
  }
  .chat-anon-close:hover{
    background: rgba(15, 23, 42, 0.08);
  }
  .chat-composer-bar{
    position:sticky;
    bottom:0;
    z-index:40;
    padding:8px 12px calc(8px + env(safe-area-inset-bottom, 0));
    background: color-mix(in srgb, var(--surface) 96%, rgba(255, 255, 255, 0.92));
    border-top:1px solid color-mix(in srgb, var(--grey-200) 60%, transparent);
    box-shadow:0 -8px 24px rgba(15, 23, 42, 0.1);
    backdrop-filter: blur(18px);
  }
  .chat-composer-bar .chat-composer{
    gap:8px;
    padding:8px 10px;
    border-radius:18px;
    border:1px solid color-mix(in srgb, var(--grey-200) 65%, transparent);
    background: color-mix(in srgb, var(--surface) 98%, rgba(255, 255, 255, 0.95));
  }
  .chat-composer-bar .chat-composer textarea{
    padding:0;
    min-height:40px;
    max-height:9.5rem;
    border:none;
    background:transparent;
    font-size:0.95rem;
  }
  .chat-composer-bar .composer-icon-btn{
    width:44px;
    height:44px;
  }
  .chat-composer-bar .composer-icon-btn svg,
  .chat-composer-bar .composer-icon-btn .spinner{
    width:18px;
    height:18px;
  }
  .chat-shell,
  .chat-messages,
  .chat-composer-bar,
  .chat-composer{
    overflow-x:hidden;
  }
}

@media (prefers-reduced-motion: reduce){
  .composer-icon-btn,
  .composer-icon-btn.listening::after,
  .vk-key,
  .jump-latest{
    transition:none;
    animation:none;
  }
  .msg{
    animation:none;
  }
}

/* --- Agreements modal --- */
.chat-agreements-backdrop{
  position:fixed;
  inset:0;
  background:rgba(17,24,39,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  z-index:1000;
}
.chat-agreements-modal{
  width:min(720px, 100%);
  max-height:100%;
  overflow:auto;
  background:var(--surface);
  border-radius:var(--radius-xl, 18px);
  box-shadow:0 22px 60px rgba(15,23,42,.25);
  border:1px solid var(--grey-300);
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.chat-agreements-content{
  display:grid;
  gap:18px;
}
.chat-agreements-scroll{
  max-height:45vh;
  overflow:auto;
  padding-right:6px;
  display:grid;
  gap:18px;
}
.chat-agreements-section{
  border:1px solid var(--grey-200);
  border-radius:var(--radius-lg);
  padding:16px;
  background:var(--surface-alt, #f9fafb);
}
.chat-agreements-readmore{
  margin:8px 0 0;
  font-size:0.88rem;
}
.chat-agreements-readmore a{
  color:var(--brand);
  text-decoration:underline;
}
.chat-agreements-section h3{
  margin-top:0;
  margin-bottom:8px;
}
.chat-agreements-checklist{
  display:grid;
  gap:10px;
  margin:0;
  padding:0;
  list-style:none;
}
.chat-agreements-actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  flex-wrap:wrap;
}
.chat-agreements-error{
  border:1px solid var(--warning-300, #f2b27b);
  background:var(--warning-50, #fff7ed);
  color:var(--warning-900, #7c3e1d);
  border-radius:var(--radius-md);
  padding:10px 12px;
}

/* --- Service form modal --- */
.chat-service-form-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.55);
  display:flex;
  align-items:flex-start;
  justify-content:center;
  overflow:auto;
  padding:32px 16px;
  z-index:1000;
}
.chat-service-form{
  width:min(760px, 100%);
  background:var(--surface);
  border-radius:var(--radius-xl, 18px);
  border:1px solid var(--grey-300);
  box-shadow:0 22px 60px rgba(15,23,42,.25);
  display:flex;
  flex-direction:column;
  gap:18px;
  padding:24px;
}
.chat-service-form-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
}
.chat-service-form-head h2{
  margin:0 0 6px;
}
.chat-service-form-body{
  display:flex;
  flex-direction:column;
  gap:18px;
}
.chat-service-form-grid{
  display:grid;
  gap:16px;
}
.chat-service-form-field{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.chat-service-form-field label{
  font-weight:600;
  display:flex;
  align-items:center;
  gap:6px;
}
.chat-service-form-field input[type="text"],
.chat-service-form-field select,
.chat-service-form-field textarea{
  border:1px solid var(--grey-300);
  border-radius:var(--radius-md);
  padding:10px 12px;
  font:inherit;
}
.chat-service-form-field textarea{
  min-height:84px;
  resize:vertical;
}
.chat-service-form-checkbox{
  display:flex;
  gap:8px;
  align-items:center;
  font-weight:400;
}
.chat-service-form-helper{
  margin:0;
  font-size:.9rem;
  color:var(--grey-600);
}
.chat-service-form-error{
  margin:0;
  font-size:.9rem;
  color:var(--warning-900, #7c3e1d);
}
.chat-service-form-server-error{
  border:1px solid var(--warning-300, #f2b27b);
  background:var(--warning-50, #fff7ed);
  color:var(--warning-900, #7c3e1d);
  border-radius:var(--radius-md);
  padding:10px 12px;
}
.chat-service-form-actions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  flex-wrap:wrap;
}
.chat-service-form .icon-btn{
  border:0;
  background:transparent;
  font-size:1rem;
  line-height:1;
  cursor:pointer;
  color:var(--grey-600);
}
.chat-service-form .icon-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}
.chat-service-form .required{
  color:var(--brand, #2563eb);
  font-weight:700;
}

.chat-service-form-multiselect{
  position:relative;
}
.chat-service-form-multiselect .multiselect-trigger{
  width:100%;
  border:1px solid var(--grey-300);
  border-radius:var(--radius-md);
  padding:10px 12px;
  text-align:left;
  background:var(--surface);
  font:inherit;
  cursor:pointer;
}
.chat-service-form-multiselect .multiselect-trigger:disabled{
  opacity:.6;
  cursor:not-allowed;
}
.chat-service-form-multiselect .multiselect-menu{
  position:absolute;
  inset:calc(100% + 4px) 0 auto 0;
  z-index:10;
  border:1px solid var(--grey-300);
  border-radius:var(--radius-md);
  background:var(--surface);
  box-shadow:0 12px 30px rgba(15,23,42,.18);
  max-height:220px;
  overflow:auto;
  padding:8px;
  display:grid;
  gap:6px;
}
.chat-service-form-multiselect .multiselect-option{
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:400;
}
.chat-service-form-multiselect .multiselect-close{
  margin-top:4px;
  align-self:end;
  padding:6px 10px;
  border:1px solid var(--grey-300);
  border-radius:var(--radius-sm);
  background:var(--surface-alt);
  cursor:pointer;
}
.chat-service-form-multiselect .multiselect-close:hover{
  background:var(--surface);
}

@media (max-width: 900px){
  .anon-banner{
    flex-direction:column;
    align-items:flex-start;
    gap:8px;
  }

  .chat-page{
    display:flex;
    flex-direction:column;
    gap:12px;
    height:auto !important;
    min-height:calc(100vh - 160px);
    overflow:visible;
    padding-bottom:calc(96px + env(safe-area-inset-bottom, 0));
  }

  .chat-page.-collapsed{
    padding-bottom:calc(96px + env(safe-area-inset-bottom, 0));
  }

  .chat-sidebar{
    position:fixed;
    inset:72px 16px calc(140px + env(safe-area-inset-bottom, 0));
    z-index:1300;
    max-height:calc(100vh - 72px - (140px + env(safe-area-inset-bottom, 0)));
    overflow:hidden;
    box-shadow:var(--shadow-md);
  }

  .chat-sidebar .sidebar-body{
    overflow:auto;
    max-height:calc(100vh - 72px - (190px + env(safe-area-inset-bottom, 0)));
  }

  .chat-page.-collapsed .chat-sidebar{
    display:none;
  }

  .hambtn{
    position:fixed;
    top:auto;
    bottom:calc(108px + env(safe-area-inset-bottom, 0));
    right:16px;
    left:auto;
    z-index:1300;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    background:var(--surface);
    box-shadow:var(--shadow-md);
  }

  .chat-main{
    min-height:45vh;
  }

  .composer-dock{
    position:sticky;
    bottom:calc(96px + env(safe-area-inset-bottom, 0));
    margin-bottom:calc(96px + env(safe-area-inset-bottom, 0));
  }

  .chat-alert{
    margin:8px 12px 0;
  }
}
